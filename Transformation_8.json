Input Json
{
  "employees": [
    {
      "name": "John Doe",
      "salary": 50000,
      "department": "Sales"
    },
    {
      "name": "Jane Smith",
      "salary": 60000
    },
    {
      "name": "Bob Johnson",
      "department": "IT"
    }
  ]
}

Output Json
{
  "employees": [
    {
      "name": "John Doe",
      "salary": 50000,
      "department": "Sales",
      "bonus": 1000
    },
    {
      "name": "Jane Smith",
      "salary": 60000,
      "department": "Marketing",
      "bonus": 1500
    },
    {
      "name": "Bob Johnson",
      "salary": 45000,
      "department": "IT",
      "bonus": 900
    }
  ],
  "totalBonus": 3400
}

Jolt Spec

[
  {
    "operation": "modify-overwrite-beta",
    "spec": {
      "employees": {
        "[0]": {
          "bonus": "=divide(@(1,salary),50)",
          "temp": "@(1,bonus)"
        },
        "[1]": {
          "department": "Marketing",
          "bonus": "=divide(@(1,salary),40)",
          "temp": "@(1,bonus)"
        },
        "[2]": {
          "salary": 45000,
          "bonus": "=divide(@(1,salary),50)",
          "temp": "@(1,bonus)"
        }
      }
    }
  },
  {
    "operation": "shift",
    "spec": {
      "employees": {
        "*": {
          "*": "employees.[#2].&",
          "temp": "totalBonus"
        }
      }
    }
  },
  {
    "operation": "modify-overwrite-beta",
    "spec": {
      "totalBonus": "=intSum(@(1,totalBonus))"
    }
  }
]
