Input Json

{
    "orders": [
        {
            "id": "order1",
            "date": "2022-01-01T00:00:00Z",
            "customerId": "customer1",
            "items": [
                {
                    "id": "item1",
                    "name": "Product 1",
                    "price": 10,
                    "quantity": 2
                },
                {
                    "id": "item2",
                    "name": "Product 2",
                    "price": 20,
                    "quantity": 1
                }
            ],
            "totalPrice": 40
        },
        {
            "id": "order2",
            "date": "2022-02-01T00:00:00Z",
            "customerId": "customer1",
            "items": [
                {
                    "id": "item3",
                    "name": "Product 3",
                    "price": 30,
                    "quantity": 3
                }
            ],
            "totalPrice": 90
        },
        {
            "id": "order3",
            "date": "2022-03-01T00:00:00Z",
            "customerId": "customer2",
            "items": [
                {
                    "id": "item4",
                    "name": "Product 4",
                    "price": 40,
                    "quantity": 4
                }
            ],
            "totalPrice": 160
        }
    ]
}


Json Spec

[
    {
        "operation": "shift",
        "spec": {
            "orders": {
                "*": {
                    "@": "@(1,customerId)[]"
                }
            }
        }
    },
    {
        "operation": "modify-overwrite-beta",
        "spec": {
            "customer1": {
                "*": {
                    "name": "John Smith",
                    "amount": "@(1,totalPrice)"
                }
            },
            "customer2": {
                "*": {
                    "name": "Jane Doe",
                    "amount": "@(1,totalPrice)"
                }
            }
        }
    },
    {
        "operation": "shift",
        "spec": {
            "*": {
                "*": {
                    "customerId": "customers[#3].id",
                    "name": "customers[#3].name",
                    "id": "customers[#3].orders[&1].&",
                    "date": "customers[#3].orders[&1].&",
                    "items": "customers[#3].orders[&1].&",
                    "totalPrice": "customers[#3].orders[&1].&",
                    "amount": "customers[#3].totalAmount"
                }
            }
        }
    },
    {
        "operation": "modify-overwrite-beta",
        "spec": {
            "customers": {
                "*": {
                    "id": "=firstElement(@(1,id))",
                    "name": "=firstElement(@(1,name))",
                    "totalAmount": "=intSum(@(1,totalAmount))"
                }
            }
        }
    }
]   



Output Json

{
    "customers": [
        {
            "id": "customer1",
            "name": "John Smith",
            "orders": [
                {
                    "id": "order1",
                    "date": "2022-01-01T00:00:00Z",
                    "items": [
                        {
                            "id": "item1",
                            "name": "Product 1",
                            "price": 10,
                            "quantity": 2
                        },
                        {
                            "id": "item2",
                            "name": "Product 2",
                            "price": 20,
                            "quantity": 1
                        }
                    ],
                    "totalPrice": 40
                },
                {
                    "id": "order2",
                    "date": "2022-02-01T00:00:00Z",
                    "items": [
                        {
                            "id": "item3",
                            "name": "Product 3",
                            "price": 30,
                            "quantity": 3
                        }
                    ],
                    "totalPrice": 90
                }
            ],
            "totalAmount": 130
        },
        {
            "id": "customer2",
            "name": "Jane Doe",
            "orders": [
                {
                    "id": "order3",
                    "date": "2022-03-01T00:00:00Z",
                    "items": [
                        {
                            "id": "item4",
                            "name": "Product 4",
                            "price": 40,
                            "quantity": 4
                        }
                    ],
                    "totalPrice": 160
                }
            ],
            "totalAmount": 160
        }
    ]
}