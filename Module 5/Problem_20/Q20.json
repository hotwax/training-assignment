Input Json

{
    "employees": [
        {
            "name": "John",
            "age": 30,
            "department": {
                "id": 1,
                "name": "Sales"
            }
        },
        {
            "name": "Jane",
            "age": 35,
            "department": {
                "id": 2,
                "name": "Marketing"
            }
        },
        {
            "name": "Bob",
            "age": 40,
            "department": {
                "id": 1,
                "name": "Sales"
            }
        }
    ]
}

Json Spec

[
    {
        "operation": "shift",
        "spec": {
            "employees": {
                "*": {
                    "@department": "departments.[&]",
                    "name": "departments[#2].employees.name",
                    "age": "departments[#2].employees.age"
                }
            }
        }
    },
    {
        "operation": "shift",
        "spec": {
            "departments": {
                "*": {
                    "id": "departments.@(1,id).id",
                    "name": "departments.@(1,id).name",
                    "employees": "departments.@(1,id).employees[]"
                }
            }
        }
    },
    {
        "operation": "shift",
        "spec": {
            "departments": {
                "*": "departments"
            }
        }
    },
    {
        "operation": "modify-overwrite-beta",
        "spec": {
            "departments": {
                "*": {
                    "*": {
                        "employees": "&"
                    },
                    "id": "@(1,id[0])",
                    "name": "@(1,name[0])"
                }
            }
        }
    }
]

Output Json

  {
    "departments": [
        {
            "id": 1,
            "name": "Sales",
            "employees": [
                {
                    "name": "John",
                    "age": 30
                },
                {
                    "name": "Bob",
                    "age": 40
                }
            ]
        },
        {
            "id": 2,
            "name": "Marketing",
            "employees": [
                {
                    "name": "Jane",
                    "age": 35
                }
            ]
        }
    ]
}